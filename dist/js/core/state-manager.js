var o=class{constructor(){this.state={user:null,cuotas:[],gastos:[],fondos:null,anuncios:[],parcialidades:[],loading:{},errors:{}},this.listeners=new Map,this.history=[],this.maxHistory=50}get(t){return this.state[t]}set(t,s,e=!0){let i=this.state[t];this.state[t]=s,e&&(this.history.push({key:t,oldValue:i,newValue:s,timestamp:Date.now()}),this.history.length>this.maxHistory&&this.history.shift()),this.notify(t,s,i),this.notify("*",{key:t,value:s,oldValue:i})}setMultiple(t){Object.entries(t).forEach(([s,e])=>{this.set(s,e,!1)}),this.notify("batch",t)}subscribe(t,s){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(s),()=>{this.listeners.get(t).delete(s)}}notify(t,s,e){this.listeners.has(t)&&this.listeners.get(t).forEach(i=>{try{i(s,e)}catch(r){console.error(`Error in listener for ${t}:`,r)}})}setLoading(t,s){this.state.loading[t]=s,this.notify("loading",this.state.loading)}setError(t,s){this.state.errors[t]=s,this.notify("errors",this.state.errors),setTimeout(()=>{this.state.errors[t]===s&&(delete this.state.errors[t],this.notify("errors",this.state.errors))},5e3)}clearError(t){delete this.state.errors[t],this.notify("errors",this.state.errors)}getState(){return{...this.state}}reset(){Object.entries({user:null,cuotas:[],gastos:[],fondos:null,anuncios:[],parcialidades:[],loading:{},errors:{}}).forEach(([s,e])=>{this.set(s,e)}),this.history=[]}getHistory(t=null){return t?this.history.filter(s=>s.key===t):[...this.history]}computed(t,s){let e=()=>{let i=t.map(r=>this.get(r));return s(...i)};return t.forEach(i=>{this.subscribe(i,e)}),e()}debug(){console.group("\u{1F50D} State Manager Debug"),console.log("State:",this.state),console.log("Listeners:",this.listeners),console.log("History:",this.history),console.groupEnd()}},n=new o;typeof window<"u"&&(window.__STATE__=n);var a=n;export{a as default};
