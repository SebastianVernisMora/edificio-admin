var l=class{constructor(){this.modules=new Map,this.loading=new Map,this.dependencies=new Map,this.baseUrl="/dist/js/modules"}register(t,e){this.dependencies.set(t,{path:e.path||`${this.baseUrl}/${t}.js`,deps:e.deps||[],preload:e.preload||!1})}async load(t){if(this.modules.has(t))return console.log(`\u2713 Module "${t}" already loaded`),this.modules.get(t);if(this.loading.has(t))return console.log(`\u23F3 Module "${t}" is loading...`),this.loading.get(t);console.log(`\u{1F4E6} Loading module "${t}"...`);let e=this.dependencies.get(t);e&&e.deps.length>0&&(console.log(`  \u21B3 Loading dependencies: ${e.deps.join(", ")}`),await Promise.all(e.deps.map(o=>this.load(o))));let s=this._loadModule(t);this.loading.set(t,s);try{let o=await s;return o.init&&typeof o.init=="function"&&(console.log(`  \u21B3 Initializing module "${t}"...`),await o.init()),this.modules.set(t,o),this.loading.delete(t),console.log(`\u2705 Module "${t}" loaded`),o}catch(o){throw this.loading.delete(t),console.error(`\u274C Error loading module "${t}":`,o),o}}async _loadModule(t){let e=this.dependencies.get(t);if(!e)throw new Error(`Module "${t}" not registered`);try{let s=await import(e.path);return s.default||s}catch(s){throw new Error(`Failed to load module "${t}": ${s.message}`)}}async preload(t){console.log(`\u{1F680} Preloading modules: ${t.join(", ")}`);let e=await Promise.allSettled(t.map(o=>this.load(o))),s=e.filter(o=>o.status==="rejected");return s.length>0&&console.warn("\u26A0\uFE0F Some modules failed to preload:",s),e}unload(t){if(this.modules.has(t)){let e=this.modules.get(t);if(e.cleanup&&typeof e.cleanup=="function"){console.log(`\u{1F9F9} Cleaning up module "${t}"...`);try{e.cleanup()}catch(s){console.error(`Error during cleanup of "${t}":`,s)}}this.modules.delete(t),console.log(`\u2713 Module "${t}" unloaded`)}}isLoaded(t){return this.modules.has(t)}get(t){return this.modules.get(t)}getLoadedModules(){return Array.from(this.modules.keys())}async reload(t){return console.log(`\u{1F504} Reloading module "${t}"...`),this.unload(t),this.load(t)}clear(){Array.from(this.modules.keys()).forEach(e=>this.unload(e)),console.log("\u{1F9F9} All modules cleared")}},i=new l;i.register("cuotas",{path:"/dist/js/modules/cuotas-optimized.js",deps:[]});i.register("gastos",{path:"/dist/js/modules/gastos-optimized.js",deps:[]});i.register("fondos",{path:"/dist/js/modules/fondos-optimized.js",deps:[]});i.register("anuncios",{path:"/dist/js/modules/anuncios-optimized.js",deps:[]});i.register("cierres",{path:"/dist/js/modules/cierres-optimized.js",deps:["cuotas","gastos"]});typeof window<"u"&&(window.__MODULES__=i);var n=i;var d=class{constructor(){this.state={user:null,cuotas:[],gastos:[],fondos:null,anuncios:[],parcialidades:[],loading:{},errors:{}},this.listeners=new Map,this.history=[],this.maxHistory=50}get(t){return this.state[t]}set(t,e,s=!0){let o=this.state[t];this.state[t]=e,s&&(this.history.push({key:t,oldValue:o,newValue:e,timestamp:Date.now()}),this.history.length>this.maxHistory&&this.history.shift()),this.notify(t,e,o),this.notify("*",{key:t,value:e,oldValue:o})}setMultiple(t){Object.entries(t).forEach(([e,s])=>{this.set(e,s,!1)}),this.notify("batch",t)}subscribe(t,e){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),()=>{this.listeners.get(t).delete(e)}}notify(t,e,s){this.listeners.has(t)&&this.listeners.get(t).forEach(o=>{try{o(e,s)}catch(a){console.error(`Error in listener for ${t}:`,a)}})}setLoading(t,e){this.state.loading[t]=e,this.notify("loading",this.state.loading)}setError(t,e){this.state.errors[t]=e,this.notify("errors",this.state.errors),setTimeout(()=>{this.state.errors[t]===e&&(delete this.state.errors[t],this.notify("errors",this.state.errors))},5e3)}clearError(t){delete this.state.errors[t],this.notify("errors",this.state.errors)}getState(){return{...this.state}}reset(){Object.entries({user:null,cuotas:[],gastos:[],fondos:null,anuncios:[],parcialidades:[],loading:{},errors:{}}).forEach(([e,s])=>{this.set(e,s)}),this.history=[]}getHistory(t=null){return t?this.history.filter(e=>e.key===t):[...this.history]}computed(t,e){let s=()=>{let o=t.map(a=>this.get(a));return e(...o)};return t.forEach(o=>{this.subscribe(o,s)}),s()}debug(){console.group("\u{1F50D} State Manager Debug"),console.log("State:",this.state),console.log("Listeners:",this.listeners),console.log("History:",this.history),console.groupEnd()}},h=new d;typeof window<"u"&&(window.__STATE__=h);var u=class{constructor(){this.routes=new Map,this.currentRoute=null,this.currentModule=null,this.history=[],this.setupNavigationListeners()}register(t,e){this.routes.set(t,{moduleName:e.module,title:e.title||t,requiresAuth:e.requiresAuth!==!1,beforeEnter:e.beforeEnter||null,afterEnter:e.afterEnter||null})}setupNavigationListeners(){document.addEventListener("click",async t=>{let e=t.target.closest('a[href^="#"]');if(!e)return;t.preventDefault();let s=e.getAttribute("href").substring(1);await this.navigate(s)}),window.addEventListener("popstate",t=>{t.state&&t.state.path&&this.navigate(t.state.path,!1)}),document.addEventListener("click",t=>{let e=t.target.closest(".sidebar-nav li");e&&(document.querySelectorAll(".sidebar-nav li").forEach(s=>{s.classList.remove("active")}),e.classList.add("active"))})}async navigate(t,e=!0){console.log(`\u{1F9ED} Navigating to: ${t}`);let s=this.routes.get(t);if(!s){console.error(`Route "${t}" not found`),this.showError(`P\xE1gina no encontrada: ${t}`);return}if(s.requiresAuth&&!this.isAuthenticated()){console.warn("User not authenticated, redirecting to login"),window.location.href="/";return}if(s.beforeEnter&&!await s.beforeEnter()){console.log("Navigation cancelled by beforeEnter hook");return}this.showLoader();try{this.currentModule&&this.currentModule!==s.moduleName&&await this.unloadCurrentModule(),await n.load(s.moduleName),this.currentModule=s.moduleName,this.currentRoute=t,this.showSection(t),document.title=`Edificio Admin | ${s.title}`,e&&window.history.pushState({path:t},"",`#${t}`),this.history.push({path:t,timestamp:Date.now()}),s.afterEnter&&await s.afterEnter(),console.log(`\u2705 Navigation complete: ${t}`)}catch(o){console.error("Navigation error:",o),this.showError(`Error al cargar: ${o.message}`)}finally{this.hideLoader()}}async unloadCurrentModule(){this.currentModule&&(console.log(`\u{1F5D1}\uFE0F Unloading module: ${this.currentModule}`),n.unload(this.currentModule))}showSection(t){document.querySelectorAll(".content-section").forEach(s=>{s.classList.remove("active"),s.style.display="none"});let e=document.getElementById(`${t}-section`);if(e){e.classList.add("active"),e.style.display="block";let s=document.getElementById("page-title");if(s){let o=this.routes.get(t);s.textContent=o?o.title:t}}else console.warn(`Section "${t}-section" not found in DOM`)}isAuthenticated(){return!!localStorage.getItem("edificio_token")}showLoader(){if(document.body.classList.add("loading"),!document.getElementById("router-loader")){let t=document.createElement("div");t.id="router-loader",t.className="router-loader",t.innerHTML=`
        <div class="spinner"></div>
        <p>Cargando...</p>
      `,document.body.appendChild(t)}}hideLoader(){document.body.classList.remove("loading");let t=document.getElementById("router-loader");t&&t.remove()}showError(t){alert(t)}getCurrentRoute(){return this.currentRoute}back(){window.history.back()}forward(){window.history.forward()}async preloadRoutes(t){let e=t.map(s=>this.routes.get(s)).filter(s=>s).map(s=>s.moduleName);await n.preload(e)}},r=new u;r.register("dashboard",{module:"dashboard",title:"Dashboard"});r.register("usuarios",{module:"usuarios",title:"Usuarios"});r.register("cuotas",{module:"cuotas",title:"Cuotas"});r.register("gastos",{module:"gastos",title:"Gastos"});r.register("fondos",{module:"fondos",title:"Fondos"});r.register("anuncios",{module:"anuncios",title:"Anuncios"});r.register("cierres",{module:"cierres",title:"Cierres"});r.register("parcialidades",{module:"parcialidades",title:"Parcialidades 2026"});typeof window<"u"&&(window.__ROUTER__=r);var y=r;export{y as default};
